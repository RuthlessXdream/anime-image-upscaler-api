@echo off
echo ğŸ”¥ é…ç½®Windowsé˜²ç«å¢™å…è®¸ç«¯å£8000è®¿é—®
echo ================================================

:: æ£€æŸ¥ç®¡ç†å‘˜æƒé™
net session >nul 2>&1
if %errorLevel% == 0 (
    echo âœ… æ£€æµ‹åˆ°ç®¡ç†å‘˜æƒé™
) else (
    echo âŒ éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½é…ç½®é˜²ç«å¢™
    echo ğŸ’¡ è¯·å³é”®ç‚¹å‡»æ­¤æ–‡ä»¶ï¼Œé€‰æ‹©"ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"
    pause
    exit /b 1
)

echo.
echo ğŸ”§ æ­£åœ¨æ·»åŠ é˜²ç«å¢™å…¥ç«™è§„åˆ™...

:: åˆ é™¤å¯èƒ½å­˜åœ¨çš„æ—§è§„åˆ™
netsh advfirewall firewall delete rule name="åŠ¨æ¼«å›¾ç‰‡é«˜æ¸…ä¿®å¤API" >nul 2>&1

:: æ·»åŠ æ–°çš„å…¥ç«™è§„åˆ™
netsh advfirewall firewall add rule name="åŠ¨æ¼«å›¾ç‰‡é«˜æ¸…ä¿®å¤API" dir=in action=allow protocol=TCP localport=8000

if %errorLevel% == 0 (
    echo âœ… é˜²ç«å¢™è§„åˆ™æ·»åŠ æˆåŠŸï¼
    echo ğŸ“¡ ç«¯å£8000ç°åœ¨å…è®¸å¤–éƒ¨è®¿é—®
    echo.
    echo ğŸŒ å±€åŸŸç½‘è®¾å¤‡ç°åœ¨å¯ä»¥è®¿é—®APIæœåŠ¡
    echo ğŸ’¡ ç¡®ä¿APIæœåŠ¡æ­£åœ¨è¿è¡Œåœ¨0.0.0.0:8000
) else (
    echo âŒ é˜²ç«å¢™è§„åˆ™æ·»åŠ å¤±è´¥
    echo ğŸ’¡ è¯·æ‰‹åŠ¨é…ç½®é˜²ç«å¢™æˆ–æ£€æŸ¥æƒé™
)

echo.
echo ğŸ“‹ æ‰‹åŠ¨é…ç½®æ­¥éª¤ï¼š
echo 1. æ‰“å¼€"æ§åˆ¶é¢æ¿" -> "ç³»ç»Ÿå’Œå®‰å…¨" -> "Windows Defenderé˜²ç«å¢™"
echo 2. ç‚¹å‡»"é«˜çº§è®¾ç½®"
echo 3. é€‰æ‹©"å…¥ç«™è§„åˆ™" -> "æ–°å»ºè§„åˆ™"
echo 4. é€‰æ‹©"ç«¯å£" -> "TCP" -> "ç‰¹å®šæœ¬åœ°ç«¯å£" -> è¾“å…¥"8000"
echo 5. é€‰æ‹©"å…è®¸è¿æ¥" -> å®Œæˆè®¾ç½®

echo.
pause 